<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Spotify + Rick and Morty</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        padding-top: 3.5rem;
      }
      pre {
        white-space: pre-wrap;
      }
      .response-area {
        max-height: 350px;
        overflow: auto;
      }
    </style>
  </head>
  <body>
    <main>
      <header>
        <div class="container">
          <h1>Spotify + Rick and Morty</h1>
        </div>
      </header>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const base = "/api/items";
      const logEl = document.getElementById("log");
      function log(msg, json) {
        const time = new Date().toLocaleTimeString();
        if (json) {
          logEl.textContent =
            `[${time}] ${msg}\n` +
            JSON.stringify(json, null, 2) +
            "\n\n" +
            logEl.textContent;
        } else {
          logEl.textContent = `[${time}] ${msg}\n\n` + logEl.textContent;
        }
      }

      async function request(url, options = {}) {
        log(`Request: ${options.method || "GET"} ${url}`);
        try {
          const res = await fetch(url, options);
          const contentType = res.headers.get("content-type") || "";
          let body = null;
          if (contentType.includes("application/json")) body = await res.json();
          else body = await res.text();
          log(`Status: ${res.status} ${res.statusText}`, body);
          return { res, body };
        } catch (err) {
          log(`Erro: ${err.message}`);
          console.error(err);
          throw err;
        }
      }

      document.getElementById("btnList").addEventListener("click", async () => {
        await request(base);
      });

      document
        .getElementById("btnCreate")
        .addEventListener("click", async () => {
          const title = document.getElementById("createTitle").value;
          const body = document.getElementById("createBody").value;
          await request(base, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ title, body }),
          });
        });

      document
        .getElementById("btnUpdate")
        .addEventListener("click", async () => {
          const id = document.getElementById("updateId").value;
          const title = document.getElementById("updateTitle").value;
          const body = document.getElementById("updateBody").value;
          if (!id) return log("Informe ID para atualizar");
          await request(`${base}/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ title, body }),
          });
        });

      document
        .getElementById("btnDelete")
        .addEventListener("click", async () => {
          const id = document.getElementById("deleteId").value;
          if (!id) return log("Informe ID para remover");
          await request(`${base}/${id}`, { method: "DELETE" });
        });

      document.getElementById("btnClear").addEventListener("click", () => {
        logEl.textContent = "Pronto.";
      });
    </script>
  </body>
</html>
