<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>API Demo - Express</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body { padding-top: 3.5rem; }
      pre { white-space: pre-wrap; }
      .response-area { max-height: 350px; overflow: auto; }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-secondary fixed-top">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">API Demo Express</a>
      </div>
    </nav>

    <main class="container">
      <div class="py-5 text-center">
        <h2>API local com Node + Express</h2>
        <p class="lead">Este exemplo serve uma pequena API local e a página HTML que a consome. Abra em `http://localhost:3000` após iniciar o servidor.</p>
      </div>

      <div class="row g-4">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Listar (GET /api/items)</div>
            <div class="card-body">
              <p>Solicita a lista completa de itens.</p>
              <button id="btnList" class="btn btn-success">Listar itens</button>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Criar (POST /api/items)</div>
            <div class="card-body">
              <div class="mb-3">
                <label for="createTitle" class="form-label">Título</label>
                <input id="createTitle" class="form-control" />
              </div>
              <div class="mb-3">
                <label for="createBody" class="form-label">Corpo</label>
                <input id="createBody" class="form-control" />
              </div>
              <button id="btnCreate" class="btn btn-primary">Criar item</button>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Atualizar (PUT /api/items/:id)</div>
            <div class="card-body">
              <div class="mb-3">
                <label for="updateId" class="form-label">ID</label>
                <input id="updateId" class="form-control" />
              </div>
              <div class="mb-3">
                <label for="updateTitle" class="form-label">Título</label>
                <input id="updateTitle" class="form-control" />
              </div>
              <div class="mb-3">
                <label for="updateBody" class="form-label">Corpo</label>
                <input id="updateBody" class="form-control" />
              </div>
              <button id="btnUpdate" class="btn btn-warning">Atualizar</button>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Remover (DELETE /api/items/:id)</div>
            <div class="card-body">
              <div class="mb-3">
                <label for="deleteId" class="form-label">ID</label>
                <input id="deleteId" class="form-control" />
              </div>
              <button id="btnDelete" class="btn btn-danger">Remover</button>
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="card">
            <div class="card-header">Logs / Resposta</div>
            <div class="card-body response-area">
              <div class="mb-3">
                <label for="log" class="form-label">Registro de saída</label>
                <pre id="log" class="bg-light p-3 border rounded">Pronto.</pre>
              </div>
            </div>
            <div class="card-footer text-end">
              <button id="btnClear" class="btn btn-sm btn-outline-secondary">Limpar</button>
            </div>
          </div>
        </div>

      </div>

    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const base = '/api/items';
      const logEl = document.getElementById('log');
      function log(msg, json) {
        const time = new Date().toLocaleTimeString();
        if (json) {
          logEl.textContent = `[${time}] ${msg}\n` + JSON.stringify(json, null, 2) + "\n\n" + logEl.textContent;
        } else {
          logEl.textContent = `[${time}] ${msg}\n\n` + logEl.textContent;
        }
      }

      async function request(url, options = {}) {
        log(`Request: ${options.method || 'GET'} ${url}`);
        try {
          const res = await fetch(url, options);
          const contentType = res.headers.get('content-type') || '';
          let body = null;
          if (contentType.includes('application/json')) body = await res.json();
          else body = await res.text();
          log(`Status: ${res.status} ${res.statusText}`, body);
          return { res, body };
        } catch (err) {
          log(`Erro: ${err.message}`);
          console.error(err);
          throw err;
        }
      }

      document.getElementById('btnList').addEventListener('click', async () => {
        await request(base);
      });

      document.getElementById('btnCreate').addEventListener('click', async () => {
        const title = document.getElementById('createTitle').value;
        const body = document.getElementById('createBody').value;
        await request(base, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, body })
        });
      });

      document.getElementById('btnUpdate').addEventListener('click', async () => {
        const id = document.getElementById('updateId').value;
        const title = document.getElementById('updateTitle').value;
        const body = document.getElementById('updateBody').value;
        if (!id) return log('Informe ID para atualizar');
        await request(`${base}/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, body })
        });
      });

      document.getElementById('btnDelete').addEventListener('click', async () => {
        const id = document.getElementById('deleteId').value;
        if (!id) return log('Informe ID para remover');
        await request(`${base}/${id}`, { method: 'DELETE' });
      });

      document.getElementById('btnClear').addEventListener('click', () => { logEl.textContent = 'Pronto.'; });
    </script>
  </body>
</html>